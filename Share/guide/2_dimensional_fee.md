## 深入了解Arbitrum机制：二维费用(2-Dimensional Fees)

在几个月前的Arbitrum奥德赛中，Arbitrum One经历了史无前例的用户流量。一些敏锐的用户注意到了一个奇特的现象：随着L2 gas价格的上升，一笔特定的交易所使用的L2 gas数量实际上会减少。

事实证明，这正是系统的工作原理——但对不熟悉的人来说，这看起来确实有点令人困惑。

如果你对到目前为止我们所说的内容而感到有些困惑，那这篇文章会试图把它梳理清楚；如果你实在太困惑了，甚至都不知道在困惑什么，那么欢迎你继续读下去。与此同时，你可能会发现这些关于以太坊和Arbitrum gas的入门读物很有用。(而且如果你已经能准确地把握这篇文章的走向，那你完全应该在这里申请一个职位: https://offchainlabs.com/careers/)

### 二维费用

关于Layer 2的支付费用，在一个经济设计的系统中(如Arbitrum)，你实际上是在为两件事项同时付费：L1-native资源和L2-native资源。Arbitrum One是一个Rollup，你所支付的L1资源基本上只是以太坊calldata；也就是说，你支付的是你交易的原始数据大小乘以L2对L1 calldata的价格估算（大致可以这样理解）。

你需要支付的L2资源是你的交易在Arbitrum上的通用虚拟机(VM)中进行的任何计算——执行、存储等。这个数值是L2gas价格乘以ArbGas——Arbitrum的基本计算单位——你的交易使用的数量。一笔交易要成功，需要支付的L2费用总额是这两部分的总和

#### 在一维的世界里...

棘手的是，尽管像Arbitrum这样的L2费用本质上是二维的，但目前的以太坊生态系统主要是在L1建立的，其费用可以用一维(one-dimensional)来表示。这意味着目前的基础设施——钱包、开发者库等等——假设交易格式中的费用是单一gas单位和单一gas价格的产物；当在Arbitrum上进行交易时，我们要被迫将L1和L2维度都塞进这种限制性格式中。

那么，我们是如何做到的呢？

### 我们是如何做到的 

因此，综上所述，我们的主要限制是总费用——必须包括L1和L2费用——需要表示为两个值的乘积，我们称之为 "类似gas价格"(P)和 "类似gas限额"(G)。

我们使用的P值（由Arbitrum的估算gas价格RPC折返）实际上只是L2的gas价格(估算gas价RPC增加了一个小百分比的缓冲；任何超出的部分都会被退回)。G是我们考虑L1维度的地方；调用Arbitrum的估算gas，RPC会给出一个值，其用于L2计算的ArbGas加上一个额外的缓冲区(B)，这样P*G最终足以覆盖全部交易成本。换句话说，我们增加了 "gas限制 "之类的字段，以便在给定的gas价格下支付的总金额足以支付L1和L2层面的费用。

通过一些代数运算，我们发现这个缓冲区B必须等于(L1 calldata成本)/P。

因此，总的来说，G，解压为。

L2 gas使用量+( L1 calldata价格*L1calldata大小) /(L2 gas价格)

...其中 "L2 gas价格 "的分母（回到最初的困惑）显示了为什么在所有其他数值相同的情况下，L2 gas价格的增加，实际上是减少了G的价值。

迈向二维收费标准

如果这一切看起来比较麻烦——我们非常清楚这一点；我们目前被困在生态系统目前支持的一维费用基础设施中，但理想的情况是，一个多维收费标准将被采纳并被广泛使用；现有几个提案存在，我们同样也有自己的想法。如果你有兴趣帮助协调一个新的标准，请联系我们/参与我们的研究论坛。

想要了解更多关于Arbitrum如何处理gas信息，请查看我们的Inside Arbitrum文档。
